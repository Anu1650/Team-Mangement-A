<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Create Account | ProjectPulse AI</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<!-- Favicon -->
<link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16">
<link rel="icon" href="/favicon-32x32.png" type="image/png" sizes="32x32">
<link rel="icon" href="/favicon-16x16.png" type="image/png" sizes="16x16">
<link rel="apple-touch-icon" href="/apple-touch-icon.png" sizes="180x180">
<link rel="manifest" href="/site.webmanifest">
<!-- Favicon generated from the SVG logo -->
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'><path d='M36.7273 44C33.9891 44 31.6043 39.8386 30.3636 33.69C29.123 39.8386 26.7382 44 24 44C21.2618 44 18.877 39.8386 17.6364 33.69C16.3957 39.8386 14.0109 44 11.2727 44C7.25611 44 4 35.0457 4 24C4 12.9543 7.25611 4 11.2727 4C14.0109 4 16.3957 8.16144 17.6364 14.31C18.877 8.16144 21.2618 4 24 4C26.7382 4 29.123 8.16144 30.3636 14.31C31.6043 8.16144 33.9891 4 36.7273 4C40.7439 4 44 12.9543 44 24C44 35.0457 40.7439 44 36.7273 44Z' fill='%23137fec'/></svg>">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "secondary": "#10b981",
                        "background-light": "#f8fafc",
                        "background-dark": "#0f172a",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.375rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "2xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .bg-grid-pattern {
            background-image: radial-gradient(circle, #e2e8f0 1px, transparent 1px);
            background-size: 32px 32px;
        }
        .dark .bg-grid-pattern {
            background-image: radial-gradient(circle, #1e293b 1px, transparent 1px);
        }
        .page-container {
            display: none;
        }
        .page-container.active {
            display: block;
        }
        .otp-input {
            width: 3.5rem;
            height: 3.5rem;
            font-size: 1.5rem;
            text-align: center;
            border-radius: 0.5rem;
        }
        .resend-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .timer {
            font-variant-numeric: tabular-nums;
        }
        .error-message {
            color: #ef4444;
            font-size: 0.75rem;
            margin-top: 0.25rem;
            display: none;
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display min-h-screen flex flex-col">
<!-- Navigation -->
<nav class="sticky top-0 z-50 w-full border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md">
<div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
<div class="flex items-center gap-2">
<div class="size-8 text-primary">
<svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M36.7273 44C33.9891 44 31.6043 39.8386 30.3636 33.69C29.123 39.8386 26.7382 44 24 44C21.2618 44 18.877 39.8386 17.6364 33.69C16.3957 39.8386 14.0109 44 11.2727 44C7.25611 44 4 35.0457 4 24C4 12.9543 7.25611 4 11.2727 4C14.0109 4 16.3957 8.16144 17.6364 14.31C18.877 8.16144 21.2618 4 24 4C26.7382 4 29.123 8.16144 30.3636 14.31C31.6043 8.16144 33.9891 4 36.7273 4C40.7439 4 44 12.9543 44 24C44 35.0457 40.7439 44 36.7273 44Z" fill="currentColor"></path>
</svg>
</div>
<span class="text-slate-900 dark:text-white text-lg font-bold tracking-tight">ProjectPulse AI</span>
</div>
<div class="flex items-center gap-4">
    <a href="login.html" class="text-sm font-semibold text-primary hover:text-primary/80">Already have an account? Sign In</a>
</div>
</div>
</nav>

<!-- Registration Page -->
<main class="flex-1 flex items-center justify-center p-6 bg-grid-pattern">
    <div class="w-full max-w-5xl bg-white dark:bg-slate-900 rounded-2xl shadow-2xl shadow-slate-200 dark:shadow-none border border-slate-200 dark:border-slate-800 overflow-hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-0">
            <!-- Left Column - Info -->
            <div class="bg-gradient-to-br from-primary/5 to-secondary/5 dark:from-primary/10 dark:to-secondary/10 p-8 lg:p-12 border-b lg:border-b-0 lg:border-r border-slate-200 dark:border-slate-800">
                <div class="max-w-md">
                    <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 text-primary text-xs font-bold uppercase tracking-wider mb-6">
                        <span class="material-symbols-outlined text-xs">rocket_launch</span>
                        Get Started
                    </div>
                    <h2 class="text-3xl font-extrabold text-slate-900 dark:text-white mb-6">Create Your Company Account</h2>
                    <p class="text-slate-600 dark:text-slate-400 mb-8 text-lg leading-relaxed">
                        Set up your organization's workspace and get a unique company code to invite your team members.
                    </p>
                    
                    <div class="space-y-6">
                        <div class="flex items-start gap-4">
                            <div class="mt-1 bg-primary/10 p-2 rounded-lg">
                                <span class="material-symbols-outlined text-primary text-xl">verified</span>
                            </div>
                            <div>
                                <p class="text-base font-semibold text-slate-900 dark:text-white">Email Verification</p>
                                <p class="text-sm text-slate-600 dark:text-slate-400">Secure registration with OTP sent to your email</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start gap-4">
                            <div class="mt-1 bg-primary/10 p-2 rounded-lg">
                                <span class="material-symbols-outlined text-primary text-xl">badge</span>
                            </div>
                            <div>
                                <p class="text-base font-semibold text-slate-900 dark:text-white">Unique Company Code</p>
                                <p class="text-sm text-slate-600 dark:text-slate-400">Get a 9-character code (ABC123456) to share with your team</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start gap-4">
                            <div class="mt-1 bg-primary/10 p-2 rounded-lg">
                                <span class="material-symbols-outlined text-primary text-xl">workspaces</span>
                            </div>
                            <div>
                                <p class="text-base font-semibold text-slate-900 dark:text-white">Team Collaboration</p>
                                <p class="text-sm text-slate-600 dark:text-slate-400">Invite team members and manage access</p>
                            </div>
                        </div>
                    </div>

                    <!-- Testimonial/Quote -->
                    <div class="mt-8 pt-6 border-t border-slate-200 dark:border-slate-800">
                        <p class="text-sm italic text-slate-600 dark:text-slate-400">
                            "ProjectPulse AI helped us reduce cycle time by 40% and improve team collaboration."
                        </p>
                        <p class="text-xs font-semibold text-slate-900 dark:text-white mt-2">— Sarah Chen, CTO at TechFlow</p>
                    </div>
                </div>
            </div>

            <!-- Right Column - Registration Form -->
            <div class="p-8 lg:p-12">
                <!-- Step 1: Registration Form -->
                <div id="step1">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Create Account</h1>
                        <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">Fill in your details to create your company workspace</p>
                    </div>
                    
                    <div id="message" class="mb-6 p-4 rounded-lg hidden"></div>
                    
                    <form id="registrationForm" class="space-y-6">
                        <!-- Personal Information - Two Columns -->
                        <div>
                            <h3 class="text-sm font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-4">Personal Information</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-1.5" for="fullName">Full Name *</label>
                                    <input type="text" id="fullName" class="h-11 w-full rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 px-4 text-slate-900 dark:text-white text-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" placeholder="John Doe" required>
                                    <div id="fullNameError" class="error-message"></div>
                                </div>
                                
                                <div class="col-span-2 md:col-span-1">
                                    <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-1.5" for="email">Email Address *</label>
                                    <div class="relative">
                                        <input type="email" id="email" class="h-11 w-full rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 px-4 text-slate-900 dark:text-white text-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" placeholder="john@company.com" required>
                                        <div id="emailStatus" class="absolute right-3 top-1/2 transform -translate-y-1/2 hidden">
                                            <span class="material-symbols-outlined text-green-600 dark:text-green-400 text-sm">verified</span>
                                        </div>
                                    </div>
                                    <div id="emailError" class="error-message"></div>
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-1.5" for="password">Password *</label>
                                    <input type="password" id="password" class="h-11 w-full rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 px-4 text-slate-900 dark:text-white text-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" placeholder="••••••••" required minlength="8">
                                    <div id="passwordError" class="error-message"></div>
                                    <p class="text-xs text-slate-500 mt-1">Minimum 8 characters</p>
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-1.5" for="confirmPassword">Confirm Password *</label>
                                    <input type="password" id="confirmPassword" class="h-11 w-full rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 px-4 text-slate-900 dark:text-white text-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" placeholder="••••••••" required>
                                    <div id="confirmPasswordError" class="error-message"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Company Information - Two Columns -->
                        <div>
                            <h3 class="text-sm font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-4">Company Information</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="col-span-2">
                                    <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-1.5" for="companyName">Company Name *</label>
                                    <div class="relative">
                                        <input type="text" id="companyName" class="h-11 w-full rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 px-4 text-slate-900 dark:text-white text-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" placeholder="Your Company Inc." required>
                                        <div id="companyNameStatus" class="absolute right-3 top-1/2 transform -translate-y-1/2 hidden">
                                            <span class="material-symbols-outlined text-green-600 dark:text-green-400 text-sm">check_circle</span>
                                        </div>
                                    </div>
                                    <div id="companyNameError" class="error-message"></div>
                                </div>

                                <div class="col-span-2 hidden" id="companySlugSection">
                                    <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-1.5" for="companySlug">Company Folder Name</label>
                                    <div class="relative">
                                        <input type="text" id="companySlug" class="h-11 w-full rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 px-4 text-slate-900 dark:text-white text-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" readonly>
                                        <button type="button" id="editSlugBtn" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-xs text-primary hover:underline">
                                            Edit
                                        </button>
                                    </div>
                                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">
                                        This will be your company's folder name in the system
                                    </p>
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-1.5" for="position">Your Position *</label>
                                    <select id="position" class="h-11 w-full rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 px-4 text-slate-900 dark:text-white text-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" required>
                                        <option value="">Select position</option>
                                        <option value="CEO">CEO</option>
                                        <option value="CTO">CTO</option>
                                        <option value="Manager">Manager</option>
                                        <option value="Team Lead">Team Lead</option>
                                        <option value="Developer">Developer</option>
                                        <option value="Designer">Designer</option>
                                        <option value="Other">Other</option>
                                    </select>
                                    <div id="positionError" class="error-message"></div>
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-1.5" for="teamSize">Team Size *</label>
                                    <select id="teamSize" class="h-11 w-full rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 px-4 text-slate-900 dark:text-white text-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" required>
                                        <option value="">Select size</option>
                                        <option value="1-5">1-5 members</option>
                                        <option value="6-10">6-10 members</option>
                                        <option value="11-20">11-20 members</option>
                                        <option value="21-50">21-50 members</option>
                                        <option value="51+">51+ members</option>
                                    </select>
                                    <div id="teamSizeError" class="error-message"></div>
                                </div>
                                
                                <div class="col-span-2">
                                    <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-1.5" for="industry">Industry</label>
                                    <select id="industry" class="h-11 w-full rounded-lg border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 px-4 text-slate-900 dark:text-white text-sm focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all">
                                        <option value="">Select industry</option>
                                        <option value="Technology">Technology</option>
                                        <option value="Finance">Finance</option>
                                        <option value="Healthcare">Healthcare</option>
                                        <option value="E-commerce">E-commerce</option>
                                        <option value="Education">Education</option>
                                        <option value="Manufacturing">Manufacturing</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Terms & Conditions - Full Width -->
                        <div class="space-y-4">
                            <div class="flex items-start gap-2">
                                <input type="checkbox" id="terms" class="mt-1 size-4 rounded border-slate-300 text-primary focus:ring-primary" required>
                                <label for="terms" class="text-xs text-slate-600 dark:text-slate-400">
                                    I agree to the <a href="#" class="text-primary hover:underline">Terms of Service</a> and <a href="#" class="text-primary hover:underline">Privacy Policy</a>. I understand that a unique company code will be generated for my organization.
                                </label>
                            </div>
                            <div id="termsError" class="error-message"></div>
                            
                            <button type="submit" id="registerBtn" class="w-full h-11 bg-primary hover:bg-primary/90 text-white font-bold rounded-lg transition-all flex items-center justify-center gap-2 shadow-lg shadow-primary/20">
                                <span id="btnText">Verify Email & Continue</span>
                                <span id="btnIcon" class="material-symbols-outlined text-sm">arrow_forward</span>
                                <div id="btnSpinner" class="hidden">
                                    <div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                                </div>
                            </button>
                        </div>
                    </form>
                    
                    <div class="mt-6 pt-6 border-t border-slate-100 dark:border-slate-800 text-center">
                        <p class="text-xs text-slate-500 dark:text-slate-400">
                            Already have an account? 
                            <a href="login.html" class="text-slate-900 dark:text-white font-semibold hover:underline">Sign In</a>
                        </p>
                    </div>
                </div>

                <!-- Step 2: OTP Verification -->
                <div id="step2" class="hidden">
                    <div class="mb-8 text-center">
                        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary/10 mb-4">
                            <span class="material-symbols-outlined text-primary text-3xl">mail</span>
                        </div>
                        <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Verify Your Email</h1>
                        <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">
                            We've sent a 6-digit verification code to
                        </p>
                        <p class="font-semibold text-slate-900 dark:text-white" id="verificationEmail"></p>
                        <p class="text-slate-500 dark:text-slate-400 text-xs mt-1">
                            Check your inbox (and spam folder)
                        </p>
                    </div>
                    
                    <div id="otpMessage" class="mb-6 p-4 rounded-lg hidden"></div>
                    
                    <form id="otpForm" class="space-y-6">
                        <div>
                            <label class="block text-xs font-bold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-3 text-center">Enter Verification Code</label>
                            <div class="flex justify-center gap-2 mb-4">
                                <input type="text" maxlength="1" class="otp-input border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" data-index="0">
                                <input type="text" maxlength="1" class="otp-input border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" data-index="1">
                                <input type="text" maxlength="1" class="otp-input border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" data-index="2">
                                <span class="flex items-center justify-center w-8 text-slate-400">-</span>
                                <input type="text" maxlength="1" class="otp-input border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" data-index="3">
                                <input type="text" maxlength="1" class="otp-input border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" data-index="4">
                                <input type="text" maxlength="1" class="otp-input border border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50 text-slate-900 dark:text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all" data-index="5">
                            </div>
                            <input type="hidden" id="otpCode">
                            <div id="otpInputError" class="error-message text-center"></div>
                        </div>
                        
                        <div class="text-center">
                            <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">
                                Didn't receive the code? 
                                <button type="button" id="resendOtpBtn" class="text-primary font-semibold hover:underline">
                                    Resend OTP
                                </button>
                                <span id="timer" class="timer text-sm text-slate-500 dark:text-slate-400 ml-2 hidden">
                                    (Resend in <span id="countdown">60</span>s)
                                </span>
                            </p>
                        </div>
                        
                        <div class="pt-4">
                            <button type="submit" id="verifyBtn" class="w-full h-11 bg-primary hover:bg-primary/90 text-white font-bold rounded-lg transition-all shadow-lg shadow-primary/20">
                                Verify & Create Account
                            </button>
                        </div>
                        
                        <div class="text-center">
                            <button type="button" id="backToRegistrationBtn" class="text-sm text-primary hover:underline">
                                ← Back to registration
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Success Modal -->
<div id="successModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="bg-white dark:bg-slate-900 rounded-2xl p-8 max-w-lg w-full mx-4 border border-slate-200 dark:border-slate-800">
        <div class="text-center">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-100 dark:bg-green-900/30 mb-4">
                <span class="material-symbols-outlined text-green-600 dark:text-green-400 text-3xl">check_circle</span>
            </div>
            <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2">Account Created Successfully!</h3>
            <p class="text-slate-600 dark:text-slate-400 mb-6">
                Your company workspace has been created. Save your company code to invite team members.
            </p>
            
            <!-- Company Info Card -->
            <div class="bg-slate-50 dark:bg-slate-800 p-4 rounded-lg mb-6">
                <div class="flex items-center gap-3 mb-4">
                    <div class="bg-primary/10 p-2 rounded">
                        <span class="material-symbols-outlined text-primary">business</span>
                    </div>
                    <div class="text-left">
                        <h4 class="font-bold text-slate-900 dark:text-white" id="successCompanyName"></h4>
                    </div>
                </div>
                
                <div>
                    <p class="text-sm text-slate-500 dark:text-slate-400 mb-1">Your Company Code:</p>
                    <div class="flex items-center justify-center gap-2">
                        <span id="generatedCode" class="text-2xl font-bold text-primary tracking-wider"></span>
                        <button id="copyCodeBtn" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg">
                            <span class="material-symbols-outlined text-slate-500">content_copy</span>
                        </button>
                    </div>
                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-2">
                        Share this code with your team members
                    </p>
                </div>
            </div>
            
            <div class="flex gap-3">
                <button id="goToDashboardBtn" class="flex-1 h-11 bg-primary hover:bg-primary/90 text-white font-bold rounded-lg transition-all">
                    Go to Dashboard
                </button>
                <a href="login.html" class="flex-1 h-11 border border-slate-200 dark:border-slate-800 text-slate-700 dark:text-slate-300 font-bold rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex items-center justify-center">
                    Sign In
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    // API Configuration
    const API_BASE = 'http://localhost:3000';

    // Main application
    class RegistrationApp {
        constructor() {
            this.currentStep = 1;
            this.userData = null;
            this.companySlug = '';
            this.resendTimer = null;
            this.init();
        }
        
        init() {
            this.bindEvents();
            this.setupOTPInputs();
            this.setupCompanyNameValidation();
            this.checkExistingSession();
        }

        checkExistingSession() {
            const token = localStorage.getItem('token');
            if (token) {
                window.location.href = 'dashboard.html';
            }
        }
        
        bindEvents() {
            // Registration form submission
            document.getElementById('registrationForm').addEventListener('submit', (e) => {
                e.preventDefault();
                this.handleRegistration();
            });
            
            // OTP form submission
            document.getElementById('otpForm').addEventListener('submit', (e) => {
                e.preventDefault();
                this.handleOTPVerification();
            });
            
            // Resend OTP button
            document.getElementById('resendOtpBtn').addEventListener('click', () => {
                this.resendOTP();
            });
            
            // Back to registration button
            document.getElementById('backToRegistrationBtn').addEventListener('click', () => {
                this.showStep(1);
            });
            
            // Copy code button
            document.getElementById('copyCodeBtn').addEventListener('click', () => {
                this.copyCompanyCode();
            });
            
            // Go to dashboard button
            document.getElementById('goToDashboardBtn').addEventListener('click', () => {
                window.location.href = 'dashboard.html';
            });
            
            // Edit slug button
            document.getElementById('editSlugBtn')?.addEventListener('click', () => {
                this.enableSlugEdit();
            });
            
            // Email validation on blur
            document.getElementById('email').addEventListener('blur', () => {
                this.validateEmail();
            });
        }
        
        setupCompanyNameValidation() {
            const companyNameInput = document.getElementById('companyName');
            let debounceTimer;
            
            companyNameInput.addEventListener('input', () => {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    this.validateCompanyName();
                }, 500);
            });
        }
        
        setupOTPInputs() {
            const otpInputs = document.querySelectorAll('.otp-input[data-index]');
            
            otpInputs.forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    // Allow only numbers
                    e.target.value = e.target.value.replace(/[^0-9]/g, '');
                    
                    // Move to next input if current is filled
                    if (e.target.value.length === 1 && index < otpInputs.length - 1) {
                        otpInputs[index + 1].focus();
                    }
                    
                    // Update hidden OTP field
                    this.updateOTPValue();
                });
                
                input.addEventListener('keydown', (e) => {
                    // Handle backspace
                    if (e.key === 'Backspace' && !e.target.value && index > 0) {
                        otpInputs[index - 1].focus();
                    }
                });
            });
        }
        
        updateOTPValue() {
            const otpInputs = document.querySelectorAll('.otp-input[data-index]');
            let otp = '';
            otpInputs.forEach(input => {
                otp += input.value;
            });
            document.getElementById('otpCode').value = otp;
        }
        
        validateEmail() {
            const email = document.getElementById('email').value.trim();
            const emailStatus = document.getElementById('emailStatus');
            const emailError = document.getElementById('emailError');
            
            if (!email) return false;
            
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                emailError.textContent = 'Please enter a valid email address';
                emailError.style.display = 'block';
                emailStatus.classList.add('hidden');
                return false;
            }
            
            emailError.style.display = 'none';
            emailStatus.classList.remove('hidden');
            return true;
        }
        
        async validateCompanyName() {
            const companyName = document.getElementById('companyName').value.trim();
            const companyNameStatus = document.getElementById('companyNameStatus');
            const companyNameError = document.getElementById('companyNameError');
            const companySlugSection = document.getElementById('companySlugSection');
            
            if (!companyName) {
                companyNameStatus.classList.add('hidden');
                companyNameError.style.display = 'none';
                companySlugSection.classList.add('hidden');
                return false;
            }
            
            if (companyName.length < 2) {
                companyNameStatus.classList.add('hidden');
                companyNameError.textContent = 'Company name must be at least 2 characters';
                companyNameError.style.display = 'block';
                companySlugSection.classList.add('hidden');
                return false;
            }
            
            // Generate slug from company name
            this.companySlug = this.generateSlug(companyName);
            document.getElementById('companySlug').value = this.companySlug;
            
            // Check if company already exists
            try {
                const response = await fetch(`${API_BASE}/api/companies/check?slug=${encodeURIComponent(this.companySlug)}`);
                const data = await response.json();
                
                if (response.ok && !data.exists) {
                    companyNameStatus.classList.remove('hidden');
                    companyNameError.style.display = 'none';
                    companySlugSection.classList.remove('hidden');
                    return true;
                } else {
                    companyNameStatus.classList.add('hidden');
                    companyNameError.textContent = data.message || 'Company name already exists';
                    companyNameError.style.display = 'block';
                    companySlugSection.classList.add('hidden');
                    return false;
                }
            } catch (error) {
                console.error('Error checking company name:', error);
                companyNameStatus.classList.remove('hidden');
                companyNameError.style.display = 'none';
                companySlugSection.classList.remove('hidden');
                return true;
            }
        }
        
        generateSlug(companyName) {
            return companyName
                .toLowerCase()
                .replace(/[^\w\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/--+/g, '-')
                .trim();
        }
        
        enableSlugEdit() {
            const slugInput = document.getElementById('companySlug');
            const editBtn = document.getElementById('editSlugBtn');
            
            slugInput.removeAttribute('readonly');
            slugInput.focus();
            editBtn.textContent = 'Save';
            
            editBtn.onclick = () => {
                this.saveCustomSlug();
            };
        }
        
        saveCustomSlug() {
            const slugInput = document.getElementById('companySlug');
            const editBtn = document.getElementById('editSlugBtn');
            const customSlug = slugInput.value.trim();
            
            if (!customSlug) {
                this.showMessage('Company folder name cannot be empty', 'error');
                return;
            }
            
            if (!/^[a-z0-9-]+$/.test(customSlug)) {
                this.showMessage('Folder name can only contain lowercase letters, numbers, and hyphens', 'error');
                return;
            }
            
            this.companySlug = customSlug;
            slugInput.setAttribute('readonly', true);
            editBtn.textContent = 'Edit';
            
            editBtn.onclick = () => {
                this.enableSlugEdit();
            };
            
            this.showMessage('Folder name updated', 'success');
        }
        
        clearErrors() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.style.display = 'none';
                el.textContent = '';
            });
        }
        
        validateRegistration(data) {
            this.clearErrors();
            let isValid = true;
            
            // Check required fields
            if (!data.fullName) {
                document.getElementById('fullNameError').textContent = 'Full name is required';
                document.getElementById('fullNameError').style.display = 'block';
                isValid = false;
            }
            
            if (!data.email) {
                document.getElementById('emailError').textContent = 'Email is required';
                document.getElementById('emailError').style.display = 'block';
                isValid = false;
            } else if (!this.validateEmail()) {
                isValid = false;
            }
            
            if (!data.password) {
                document.getElementById('passwordError').textContent = 'Password is required';
                document.getElementById('passwordError').style.display = 'block';
                isValid = false;
            } else if (data.password.length < 8) {
                document.getElementById('passwordError').textContent = 'Password must be at least 8 characters';
                document.getElementById('passwordError').style.display = 'block';
                isValid = false;
            }
            
            if (!data.confirmPassword) {
                document.getElementById('confirmPasswordError').textContent = 'Please confirm your password';
                document.getElementById('confirmPasswordError').style.display = 'block';
                isValid = false;
            } else if (data.password !== data.confirmPassword) {
                document.getElementById('confirmPasswordError').textContent = 'Passwords do not match';
                document.getElementById('confirmPasswordError').style.display = 'block';
                isValid = false;
            }
            
            if (!data.companyName) {
                document.getElementById('companyNameError').textContent = 'Company name is required';
                document.getElementById('companyNameError').style.display = 'block';
                isValid = false;
            }
            
            if (!data.position) {
                document.getElementById('positionError').textContent = 'Please select your position';
                document.getElementById('positionError').style.display = 'block';
                isValid = false;
            }
            
            if (!data.teamSize) {
                document.getElementById('teamSizeError').textContent = 'Please select team size';
                document.getElementById('teamSizeError').style.display = 'block';
                isValid = false;
            }
            
            if (!document.getElementById('terms').checked) {
                document.getElementById('termsError').textContent = 'Please accept the terms and conditions';
                document.getElementById('termsError').style.display = 'block';
                isValid = false;
            }
            
            return isValid;
        }
        
        async handleRegistration() {
            // Get form data
            const userData = {
                fullName: document.getElementById('fullName').value.trim(),
                email: document.getElementById('email').value.trim(),
                password: document.getElementById('password').value,
                confirmPassword: document.getElementById('confirmPassword').value,
                companyName: document.getElementById('companyName').value.trim(),
                companySlug: this.companySlug,
                position: document.getElementById('position').value,
                teamSize: document.getElementById('teamSize').value,
                industry: document.getElementById('industry').value
            };
            
            // Validate form
            if (!this.validateRegistration(userData)) {
                return;
            }
            
            // Validate company name
            if (!await this.validateCompanyName()) {
                return;
            }
            
            // Show loading state
            this.setButtonLoading(true);
            
            try {
                // Send OTP request
                const response = await fetch(`${API_BASE}/api/otp/send`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        email: userData.email,
                        purpose: 'registration'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Store user data temporarily
                    this.userData = userData;
                    
                    // Show OTP step
                    document.getElementById('verificationEmail').textContent = userData.email;
                    this.showStep(2);
                    this.startResendTimer();
                    
                    this.showMessage('Verification code sent to your email', 'success', 'otpMessage');
                    
                    // For development, show OTP in console (only if returned)
                    if (data.otp) {
                        console.log('OTP for testing:', data.otp);
                    }
                } else {
                    this.showMessage(data.error || 'Failed to send verification code', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                this.showMessage('Network error. Please check if server is running at ' + API_BASE, 'error');
            } finally {
                this.setButtonLoading(false);
            }
        }
        
        async handleOTPVerification() {
            const enteredOtp = document.getElementById('otpCode').value;
            
            if (enteredOtp.length !== 6) {
                document.getElementById('otpInputError').textContent = 'Please enter the 6-digit verification code';
                document.getElementById('otpInputError').style.display = 'block';
                return;
            }
            
            // Hide any previous error
            document.getElementById('otpInputError').style.display = 'none';
            
            // Show loading state
            this.setOTPButtonLoading(true);
            
            try {
                // First verify OTP
                const verifyResponse = await fetch(`${API_BASE}/api/otp/verify`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: this.userData.email,
                        otp: enteredOtp,
                        purpose: 'registration'
                    })
                });
                
                const verifyData = await verifyResponse.json();
                
                if (!verifyResponse.ok) {
                    this.showMessage(verifyData.error || 'Verification failed', 'error', 'otpMessage');
                    this.setOTPButtonLoading(false);
                    return;
                }
                
                // OTP verified - now create account using the CORRECT endpoint
                const registerResponse = await fetch(`${API_BASE}/api/auth/register-company`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        fullName: this.userData.fullName,
                        email: this.userData.email,
                        password: this.userData.password,
                        companyName: this.userData.companyName,
                        position: this.userData.position,
                        // Note: teamSize and industry might not be in your backend schema
                        // Remove if not needed or add to backend
                    })
                });
                
                const registerData = await registerResponse.json();
                
                if (registerResponse.ok) {
                    // Save token to localStorage
                    localStorage.setItem('token', registerData.token);
                    localStorage.setItem('user', JSON.stringify(registerData.user));
                    
                    // Update success modal with company info
                    document.getElementById('successCompanyName').textContent = this.userData.companyName;
                    document.getElementById('generatedCode').textContent = registerData.user.companyCode;
                    
                    // Show success modal
                    document.getElementById('successModal').classList.remove('hidden');
                    
                    // Clear form
                    document.getElementById('registrationForm').reset();
                } else {
                    this.showMessage(registerData.error || 'Failed to create account', 'error', 'otpMessage');
                }
            } catch (error) {
                console.error('Error:', error);
                this.showMessage('Network error. Please check if server is running at ' + API_BASE, 'error', 'otpMessage');
            } finally {
                this.setOTPButtonLoading(false);
            }
        }
        
        async resendOTP() {
            if (this.resendTimer) return;
            
            // Clear previous OTP
            const otpInputs = document.querySelectorAll('.otp-input[data-index]');
            otpInputs.forEach(input => input.value = '');
            document.getElementById('otpCode').value = '';
            
            // Show loading
            const resendBtn = document.getElementById('resendOtpBtn');
            const originalText = resendBtn.textContent;
            resendBtn.textContent = 'Sending...';
            resendBtn.disabled = true;
            
            try {
                // Resend OTP request
                const response = await fetch(`${API_BASE}/api/otp/send`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        email: this.userData.email,
                        purpose: 'registration'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    this.showMessage('New verification code sent to your email', 'success', 'otpMessage');
                    this.startResendTimer();
                    
                    if (data.otp) {
                        console.log('New OTP for testing:', data.otp);
                    }
                } else {
                    this.showMessage(data.error || 'Failed to resend code', 'error', 'otpMessage');
                }
            } catch (error) {
                console.error('Error:', error);
                this.showMessage('Network error. Please check if server is running at ' + API_BASE, 'error', 'otpMessage');
            } finally {
                resendBtn.textContent = originalText;
                resendBtn.disabled = false;
            }
        }
        
        startResendTimer() {
            const resendBtn = document.getElementById('resendOtpBtn');
            const timerElement = document.getElementById('timer');
            const countdownElement = document.getElementById('countdown');
            
            resendBtn.disabled = true;
            timerElement.classList.remove('hidden');
            
            let timeLeft = 60;
            countdownElement.textContent = timeLeft;
            
            this.resendTimer = setInterval(() => {
                timeLeft--;
                countdownElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(this.resendTimer);
                    this.resendTimer = null;
                    resendBtn.disabled = false;
                    timerElement.classList.add('hidden');
                }
            }, 1000);
        }
        
        showStep(step) {
            this.currentStep = step;
            
            if (step === 1) {
                document.getElementById('step1').classList.remove('hidden');
                document.getElementById('step2').classList.add('hidden');
            } else if (step === 2) {
                document.getElementById('step1').classList.add('hidden');
                document.getElementById('step2').classList.remove('hidden');
                
                // Focus first OTP input
                setTimeout(() => {
                    document.querySelector('.otp-input[data-index="0"]').focus();
                }, 100);
            }
        }
        
        showMessage(message, type = 'info', containerId = 'message') {
            const messageElement = document.getElementById(containerId);
            messageElement.textContent = message;
            messageElement.className = `mb-6 p-4 rounded-lg ${type === 'error' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
            messageElement.classList.remove('hidden');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                messageElement.classList.add('hidden');
            }, 5000);
        }
        
        setButtonLoading(loading) {
            const btn = document.getElementById('registerBtn');
            const btnText = document.getElementById('btnText');
            const btnIcon = document.getElementById('btnIcon');
            const btnSpinner = document.getElementById('btnSpinner');
            
            if (loading) {
                btn.disabled = true;
                btnText.textContent = 'Sending OTP...';
                btnIcon.classList.add('hidden');
                btnSpinner.classList.remove('hidden');
            } else {
                btn.disabled = false;
                btnText.textContent = 'Verify Email & Continue';
                btnIcon.classList.remove('hidden');
                btnSpinner.classList.add('hidden');
            }
        }
        
        setOTPButtonLoading(loading) {
            const btn = document.getElementById('verifyBtn');
            if (loading) {
                btn.disabled = true;
                btn.innerHTML = '<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mx-auto"></div>';
            } else {
                btn.disabled = false;
                btn.textContent = 'Verify & Create Account';
            }
        }
        
        copyCompanyCode() {
            const code = document.getElementById('generatedCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                const copyBtn = document.getElementById('copyCodeBtn');
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<span class="material-symbols-outlined text-green-600">check</span>';
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                }, 2000);
            });
        }
    }

    // Initialize the application when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
        new RegistrationApp();
    });
</script>
</body>
</html>