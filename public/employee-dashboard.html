<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Employee Dashboard | ProjectPulse AI</title>
<!-- Favicon -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'><path d='M36.7273 44C33.9891 44 31.6043 39.8386 30.3636 33.69C29.123 39.8386 26.7382 44 24 44C21.2618 44 18.877 39.8386 17.6364 33.69C16.3957 39.8386 14.0109 44 11.2727 44C7.25611 44 4 35.0457 4 24C4 12.9543 7.25611 4 11.2727 4C14.0109 4 16.3957 8.16144 17.6364 14.31C18.877 8.16144 21.2618 4 24 4C26.7382 4 29.123 8.16144 30.3636 14.31C31.6043 8.16144 33.9891 4 36.7273 4C40.7439 4 44 12.9543 44 24C44 35.0457 40.7439 44 36.7273 44Z' fill='%23137fec'/></svg>">
<meta name="theme-color" content="#137fec">
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#137fec",
                        "secondary": "#10b981",
                        "background-light": "#f8fafc",
                        "background-dark": "#0f172a",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.375rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "2xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
<style type="text/tailwindcss">
        body {
            font-family: 'Inter', sans-serif;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .chat-message {
            max-width: 80%;
            border-radius: 18px;
            padding: 12px 16px;
            position: relative;
        }
        
        .chat-message.user {
            background: #137fec;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        
        .chat-message.ai {
            background: #f1f5f9;
            color: #1e293b;
            border-bottom-left-radius: 4px;
        }
        
        /* Custom scrollbar */
        #chatMessages, #aiChat {
            scroll-behavior: smooth;
        }
        
        #chatMessages::-webkit-scrollbar,
        #aiChat::-webkit-scrollbar {
            width: 6px;
        }
        
        #chatMessages::-webkit-scrollbar-track,
        #aiChat::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        #chatMessages::-webkit-scrollbar-thumb,
        #aiChat::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .dark #chatMessages::-webkit-scrollbar-track,
        .dark #aiChat::-webkit-scrollbar-track {
            background: #1e293b;
        }
        
        .dark #chatMessages::-webkit-scrollbar-thumb,
        .dark #aiChat::-webkit-scrollbar-thumb {
            background: #475569;
        }

        /* Markdown styling */
        .markdown-content h1 { font-size: 1.5rem; font-weight: bold; margin: 1rem 0; }
        .markdown-content h2 { font-size: 1.25rem; font-weight: bold; margin: 0.875rem 0; }
        .markdown-content h3 { font-size: 1.125rem; font-weight: bold; margin: 0.75rem 0; }
        .markdown-content p { margin: 0.5rem 0; }
        .markdown-content ul, .markdown-content ol { margin: 0.5rem 0; padding-left: 1.5rem; }
        .markdown-content li { margin: 0.25rem 0; }
        .markdown-content code { 
            background-color: #e2e8f0; 
            padding: 0.125rem 0.25rem; 
            border-radius: 0.25rem; 
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.875em;
        }
        .dark .markdown-content code { background-color: #334155; }
        .markdown-content pre { 
            background-color: #f8fafc; 
            padding: 1rem; 
            border-radius: 0.5rem; 
            overflow-x: auto;
            margin: 0.5rem 0;
        }
        .dark .markdown-content pre { background-color: #1e293b; }
        .markdown-content blockquote { 
            border-left: 4px solid #cbd5e1; 
            padding-left: 1rem; 
            margin: 0.5rem 0;
            color: #64748b;
        }
        .dark .markdown-content blockquote { 
            border-left-color: #475569; 
            color: #94a3b8;
        }

        /* Stat cards hover effect */
        .stat-card {
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px -8px rgba(0, 0, 0, 0.15);
        }

        /* Task item hover */
        .task-item {
            transition: all 0.2s ease;
        }
        .task-item:hover {
            background-color: #f8fafc;
        }
        .dark .task-item:hover {
            background-color: #1e293b;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display min-h-screen">
<!-- Navigation -->
<nav class="sticky top-0 z-50 w-full border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md">
<div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
<div class="flex items-center gap-2">
<div class="size-8 text-primary">
<svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path d="M36.7273 44C33.9891 44 31.6043 39.8386 30.3636 33.69C29.123 39.8386 26.7382 44 24 44C21.2618 44 18.877 39.8386 17.6364 33.69C16.3957 39.8386 14.0109 44 11.2727 44C7.25611 44 4 35.0457 4 24C4 12.9543 7.25611 4 11.2727 4C14.0109 4 16.3957 8.16144 17.6364 14.31C18.877 8.16144 21.2618 4 24 4C26.7382 4 29.123 8.16144 30.3636 14.31C31.6043 8.16144 33.9891 4 36.7273 4C40.7439 4 44 12.9543 44 24C44 35.0457 40.7439 44 36.7273 44Z" fill="currentColor"></path>
</svg>
</div>
<span class="text-slate-900 dark:text-white text-lg font-bold tracking-tight">ProjectPulse AI - Employee Dashboard</span>
</div>
<div class="flex items-center gap-4">
    <span id="currentUser" class="text-sm text-slate-600 dark:text-slate-400"></span>
    <button id="logoutBtn" class="text-sm font-semibold text-primary hover:text-primary/80">Logout</button>
</div>
</div>
</nav>

<!-- Main Dashboard -->
<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Loading State -->
    <div id="loading" class="text-center py-12">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary"></div>
        <p class="mt-4 text-slate-600 dark:text-slate-400">Loading your dashboard...</p>
    </div>

    <!-- Access Denied -->
    <div id="accessDenied" class="hidden text-center py-12">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-100 dark:bg-red-900/30 mb-4">
            <span class="material-symbols-outlined text-red-600 dark:text-red-400 text-3xl">block</span>
        </div>
        <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-2">Access Denied</h2>
        <p class="text-slate-600 dark:text-slate-400 mb-6">You need to be logged in to view this page.</p>
        <a href="login.html" class="inline-block px-6 py-3 bg-primary text-white font-medium rounded-lg hover:bg-primary/90">
            Go to Login
        </a>
    </div>

    <!-- Dashboard Content -->
    <div id="dashboardContent" class="hidden">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-slate-900 dark:text-white" id="welcomeMessage">Welcome back!</h1>
            <p class="text-slate-600 dark:text-slate-400 mt-2" id="userRole">Employee Dashboard</p>
        </div>

        <!-- Stats Cards - Employee Personal Stats -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="stat-card bg-white dark:bg-slate-900 p-6 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800">
                <div class="flex items-center gap-3 mb-2">
                    <div class="p-2 bg-blue-100 dark:bg-blue-900/20 rounded-lg">
                        <span class="material-symbols-outlined text-blue-600 dark:text-blue-400">task</span>
                    </div>
                    <h3 class="text-slate-500 dark:text-slate-400 text-sm font-medium">My Tasks</h3>
                </div>
                <p id="myTasksCount" class="text-3xl font-bold text-slate-900 dark:text-white">0</p>
                <p class="text-xs text-slate-500 mt-1"><span id="completedTasksCount">0</span> completed this week</p>
            </div>

            <div class="stat-card bg-white dark:bg-slate-900 p-6 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800">
                <div class="flex items-center gap-3 mb-2">
                    <div class="p-2 bg-green-100 dark:bg-green-900/20 rounded-lg">
                        <span class="material-symbols-outlined text-green-600 dark:text-green-400">code</span>
                    </div>
                    <h3 class="text-slate-500 dark:text-slate-400 text-sm font-medium">My Pull Requests</h3>
                </div>
                <p id="myPRsCount" class="text-3xl font-bold text-slate-900 dark:text-white">0</p>
                <p class="text-xs text-slate-500 mt-1"><span id="mergedPRsCount">0</span> merged this month</p>
            </div>

            <div class="stat-card bg-white dark:bg-slate-900 p-6 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800">
                <div class="flex items-center gap-3 mb-2">
                    <div class="p-2 bg-purple-100 dark:bg-purple-900/20 rounded-lg">
                        <span class="material-symbols-outlined text-purple-600 dark:text-purple-400">merge</span>
                    </div>
                    <h3 class="text-slate-500 dark:text-slate-400 text-sm font-medium">Review Time</h3>
                </div>
                <p id="avgReviewTime" class="text-3xl font-bold text-slate-900 dark:text-white">0d</p>
                <p class="text-xs text-slate-500 mt-1">Average PR review time</p>
            </div>

            <div class="stat-card bg-white dark:bg-slate-900 p-6 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800">
                <div class="flex items-center gap-3 mb-2">
                    <div class="p-2 bg-amber-100 dark:bg-amber-900/20 rounded-lg">
                        <span class="material-symbols-outlined text-amber-600 dark:text-amber-400">schedule</span>
                    </div>
                    <h3 class="text-slate-500 dark:text-slate-400 text-sm font-medium">Team Members</h3>
                </div>
                <p id="teamMembersCount" class="text-3xl font-bold text-slate-900 dark:text-white">0</p>
                <p class="text-xs text-slate-500 mt-1">In your company</p>
            </div>
        </div>

        <!-- Main Grid - Two Columns -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            <!-- Left Column - Tasks and PRs -->
            <div class="lg:col-span-2 space-y-6">
                <!-- My Tasks -->
                <div class="bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden">
                    <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center">
                        <h2 class="text-lg font-semibold text-slate-900 dark:text-white flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">task</span>
                            My Tasks
                        </h2>
                        <button onclick="employeeDashboard.showCreateTaskModal()" class="flex items-center gap-2 px-3 py-1.5 bg-primary text-white text-sm rounded-lg hover:bg-primary/90">
                            <span class="material-symbols-outlined text-sm">add</span>
                            New Task
                        </button>
                    </div>
                    <div id="myTasksList" class="divide-y divide-slate-200 dark:divide-slate-800">
                        <!-- Tasks will be loaded here -->
                        <div class="p-8 text-center text-slate-500">
                            <span class="material-symbols-outlined text-4xl mb-2 text-slate-300">task</span>
                            <p>No tasks assigned to you yet</p>
                        </div>
                    </div>
                    <div class="px-6 py-3 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-800">
                        <a href="#" class="text-sm text-primary hover:underline flex items-center gap-1">
                            View all tasks
                            <span class="material-symbols-outlined text-sm">arrow_forward</span>
                        </a>
                    </div>
                </div>

                <!-- My Pull Requests -->
                <div class="bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden">
                    <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-800 flex justify-between items-center">
                        <h2 class="text-lg font-semibold text-slate-900 dark:text-white flex items-center gap-2">
                            <span class="material-symbols-outlined text-green-500">code</span>
                            My Pull Requests
                        </h2>
                        <button onclick="employeeDashboard.showCreatePRModal()" class="flex items-center gap-2 px-3 py-1.5 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700">
                            <span class="material-symbols-outlined text-sm">add</span>
                            New PR
                        </button>
                    </div>
                    <div id="myPRsList" class="divide-y divide-slate-200 dark:divide-slate-800">
                        <!-- PRs will be loaded here -->
                        <div class="p-8 text-center text-slate-500">
                            <span class="material-symbols-outlined text-4xl mb-2 text-slate-300">code</span>
                            <p>No pull requests created by you</p>
                        </div>
                    </div>
                    <div class="px-6 py-3 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-200 dark:border-slate-800">
                        <a href="#" class="text-sm text-green-600 hover:underline flex items-center gap-1">
                            View all PRs
                            <span class="material-symbols-outlined text-sm">arrow_forward</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Right Column - Profile and Activity -->
            <div class="space-y-6">
                <!-- Profile Card -->
                <div class="bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden">
                    <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-800">
                        <h2 class="text-lg font-semibold text-slate-900 dark:text-white flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">person</span>
                            My Profile
                        </h2>
                    </div>
                    <div class="p-6">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="w-16 h-16 rounded-full bg-gradient-to-br from-primary to-blue-500 flex items-center justify-center text-white text-2xl font-bold" id="profileInitials">
                                JD
                            </div>
                            <div>
                                <h3 class="font-semibold text-slate-900 dark:text-white" id="profileName">Loading...</h3>
                                <p class="text-sm text-slate-500" id="profileEmail">loading@example.com</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div>
                                <p class="text-xs text-slate-500">Position</p>
                                <p class="font-medium text-slate-900 dark:text-white" id="profilePosition">Developer</p>
                            </div>
                            <div>
                                <p class="text-xs text-slate-500">Company</p>
                                <p class="font-medium text-slate-900 dark:text-white" id="profileCompany">Loading...</p>
                            </div>
                            <div>
                                <p class="text-xs text-slate-500">Joined</p>
                                <p class="font-medium text-slate-900 dark:text-white" id="profileJoined">Loading...</p>
                            </div>
                            <div>
                                <p class="text-xs text-slate-500">Role</p>
                                <p class="font-medium text-slate-900 dark:text-white" id="profileRole">Employee</p>
                            </div>
                        </div>
                        <button onclick="employeeDashboard.showEditProfileModal()" class="mt-4 w-full px-4 py-2 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 text-sm flex items-center justify-center gap-2">
                            <span class="material-symbols-outlined text-sm">edit</span>
                            Edit Profile
                        </button>
                    </div>
                </div>

                <!-- Activity Graph -->
                <div class="bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 p-6">
                    <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary">monitoring</span>
                        My Activity
                    </h2>
                    <div class="h-32 flex items-end justify-between gap-1" id="activityGraph">
                        <!-- Graph bars will be generated here -->
                    </div>
                    <div class="flex justify-between mt-2 text-xs text-slate-500">
                        <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 p-6">
                    <h2 class="text-lg font-semibold text-slate-900 dark:text-white mb-4 flex items-center gap-2">
                        <span class="material-symbols-outlined text-primary">history</span>
                        Recent Activity
                    </h2>
                    <div id="recentActivity" class="space-y-3">
                        <!-- Activity will be loaded here -->
                        <div class="text-center py-4 text-slate-500">
                            <span class="material-symbols-outlined text-3xl mb-2 text-slate-300">history</span>
                            <p class="text-sm">No recent activity</p>
                        </div>
                    </div>
                </div>

                <!-- Company Code Card -->
                <div class="bg-gradient-to-r from-primary/5 to-secondary/5 dark:from-primary/10 dark:to-secondary/10 rounded-xl p-6 border border-slate-200 dark:border-slate-800">
                    <h3 class="text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Your Company Code</h3>
                    <div class="flex items-center gap-2">
                        <p id="companyCodeDisplay" class="text-2xl font-mono font-bold text-primary"></p>
                        <button id="copyCompanyCodeBtn" class="p-2 text-slate-500 hover:text-primary rounded hover:bg-white dark:hover:bg-slate-800">
                            <span class="material-symbols-outlined text-sm">content_copy</span>
                        </button>
                    </div>
                    <p class="text-xs text-slate-500 mt-2">Share this code with colleagues to join your team</p>
                </div>
            </div>
        </div>

        <!-- AI Assistant Section (Same as admin but with employee context) -->
        <div class="bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 mb-8">
            <div class="px-6 py-4 border-b border-slate-200 dark:border-slate-800 flex items-center justify-between">
                <h2 class="text-lg font-semibold text-slate-900 dark:text-white flex items-center gap-2">
                    <span class="text-green-500">ðŸ¤–</span>
                    AI Assistant
                </h2>
                <div class="flex items-center gap-2">
                    <select id="aiModel" class="text-xs px-3 py-1.5 rounded-lg border border-slate-200 dark:border-slate-800 bg-transparent text-slate-600 dark:text-slate-400">
                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                        <option value="gpt-4">GPT-4</option>
                    </select>
                </div>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <p class="text-sm text-slate-600 dark:text-slate-400">
                        Ask the AI assistant about your tasks, coding help, or project questions.
                    </p>
                </div>
                
                <div id="aiChat" class="h-80 overflow-y-auto mb-4 space-y-4 p-2 bg-slate-50 dark:bg-slate-800/30 rounded-lg">
                    <!-- AI chat messages will be loaded here -->
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-green-500 to-blue-500 flex items-center justify-center flex-shrink-0">
                            <span class="text-white text-sm">AI</span>
                        </div>
                        <div class="flex-1">
                            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-sm">
                                <p class="text-sm text-slate-900 dark:text-slate-300">
                                    Hi! I'm your personal AI assistant. I can help you with:
                                </p>
                                <ul class="text-sm text-slate-600 dark:text-slate-400 mt-2 space-y-1">
                                    <li>â€¢ Breaking down complex tasks</li>
                                    <li>â€¢ Code reviews and best practices</li>
                                    <li>â€¢ Writing documentation</li>
                                    <li>â€¢ Problem-solving</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <form id="aiChatForm" class="flex gap-2">
                    <input type="text" id="aiInput" placeholder="Ask me anything about your work..." 
                           class="flex-1 px-4 py-3 rounded-lg border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none transition-all"
                           autocomplete="off">
                    <button type="submit" class="px-6 py-3 bg-gradient-to-r from-green-500 to-blue-500 text-white font-medium rounded-lg hover:opacity-90 transition-all disabled:opacity-50 disabled:cursor-not-allowed" id="aiSubmitBtn">
                        <span id="aiButtonText">Ask AI</span>
                        <span id="aiLoading" class="hidden animate-spin ml-2">âŸ³</span>
                    </button>
                </form>
                
                <div class="mt-3 flex justify-between items-center">
                    <div class="text-xs text-slate-500">
                        <span id="aiModelInfo">GPT-3.5 Turbo</span>
                    </div>
                    <button onclick="employeeDashboard.clearAIChat()" class="text-xs text-slate-500 hover:text-slate-700">
                        Clear chat
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Modals Container -->
<div id="modalsContainer"></div>

<!-- Notification Toast -->
<div id="notificationToast" class="fixed top-4 right-4 z-50 hidden">
    <div class="bg-white dark:bg-slate-900 rounded-lg shadow-lg border border-slate-200 dark:border-slate-800 p-4 max-w-sm">
        <div class="flex items-center gap-3">
            <span id="toastIcon" class="material-symbols-outlined text-green-500">check_circle</span>
            <div class="flex-1">
                <p id="toastTitle" class="font-medium text-slate-900 dark:text-white"></p>
                <p id="toastMessage" class="text-sm text-slate-600 dark:text-slate-400"></p>
            </div>
            <button onclick="hideToast()" class="text-slate-400 hover:text-slate-600">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>
    </div>
</div>

<script>
class EmployeeDashboard {
    constructor() {
        this.token = localStorage.getItem('token');
        this.userData = JSON.parse(localStorage.getItem('user') || '{}');
        this.dashboardData = null;
        this.aiChatHistory = [];
        this.init();
    }

    async init() {
        if (!this.token || !this.userData) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('accessDenied').classList.remove('hidden');
            return;
        }

        try {
            document.getElementById('currentUser').textContent = `Welcome, ${this.userData.fullName || 'Employee'}`;
            await this.loadDashboardData();
            this.bindEvents();
            this.updateUI();
        } catch (error) {
            console.error('Dashboard init error:', error);
            this.showNotification('Error', 'Failed to load dashboard', 'error');
        }
    }

    async loadDashboardData() {
        try {
            // In a real app, you would fetch from your API
            // For now, we'll use mock data
            this.dashboardData = {
                company: {
                    name: this.userData.companyName || 'Your Company',
                    code: this.userData.companyCode || 'ABC123456',
                    members: 10
                },
                stats: {
                    myTasks: 5,
                    completedTasks: 3,
                    myPRs: 2,
                    mergedPRs: 1,
                    avgReviewTime: '2.5',
                    teamMembers: 10
                },
                tasks: [
                    { id: 1, title: 'Update user dashboard UI', status: 'in-progress', priority: 'high', dueDate: '2024-03-20' },
                    { id: 2, title: 'Fix login page bug', status: 'todo', priority: 'medium', dueDate: '2024-03-18' },
                    { id: 3, title: 'Write API documentation', status: 'done', priority: 'low', dueDate: '2024-03-15' },
                    { id: 4, title: 'Review PR #123', status: 'in-progress', priority: 'high', dueDate: '2024-03-19' },
                    { id: 5, title: 'Setup testing environment', status: 'todo', priority: 'medium', dueDate: '2024-03-21' }
                ],
                pullRequests: [
                    { id: 101, title: 'Feature: Add dark mode', repo: 'frontend-app', status: 'open', comments: 3, createdAt: '2024-03-16' },
                    { id: 102, title: 'Fix: Authentication bug', repo: 'auth-service', status: 'review', comments: 5, createdAt: '2024-03-14' },
                    { id: 103, title: 'Docs: Update README', repo: 'docs', status: 'merged', comments: 2, createdAt: '2024-03-10' }
                ],
                activity: [
                    { type: 'task', action: 'completed', item: 'Update user dashboard UI', time: '2 hours ago' },
                    { type: 'pr', action: 'opened', item: 'Feature: Add dark mode', time: 'yesterday' },
                    { type: 'task', action: 'created', item: 'Fix login page bug', time: 'yesterday' },
                    { type: 'pr', action: 'reviewed', item: 'Fix: Authentication bug', time: '2 days ago' }
                ]
            };
            
            this.renderDashboard();
            
        } catch (error) {
            console.error('Error loading dashboard:', error);
            throw error;
        }
    }

    renderDashboard() {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('dashboardContent').classList.remove('hidden');

        // Update welcome message
        document.getElementById('welcomeMessage').textContent = `Welcome back, ${this.userData.fullName || 'Employee'}!`;
        
        // Update stats
        this.updateStats();
        
        // Update tasks list
        this.updateTasksList();
        
        // Update PRs list
        this.updatePRsList();
        
        // Update profile
        this.updateProfile();
        
        // Update activity graph
        this.updateActivityGraph();
        
        // Update recent activity
        this.updateRecentActivity();
        
        // Update company code
        document.getElementById('companyCodeDisplay').textContent = this.dashboardData.company.code;
    }

    updateUI() {
        // Set profile initials
        const name = this.userData.fullName || 'User';
        const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        document.getElementById('profileInitials').textContent = initials;
    }

    updateStats() {
        const stats = this.dashboardData.stats;
        document.getElementById('myTasksCount').textContent = stats.myTasks || 0;
        document.getElementById('completedTasksCount').textContent = stats.completedTasks || 0;
        document.getElementById('myPRsCount').textContent = stats.myPRs || 0;
        document.getElementById('mergedPRsCount').textContent = stats.mergedPRs || 0;
        document.getElementById('avgReviewTime').textContent = stats.avgReviewTime || '0';
        document.getElementById('teamMembersCount').textContent = stats.teamMembers || 0;
    }

    updateTasksList() {
        const tasksList = document.getElementById('myTasksList');
        const tasks = this.dashboardData.tasks || [];
        
        if (tasks.length === 0) {
            tasksList.innerHTML = `
                <div class="p-8 text-center text-slate-500">
                    <span class="material-symbols-outlined text-4xl mb-2 text-slate-300">task</span>
                    <p>No tasks assigned to you yet</p>
                </div>
            `;
            return;
        }

        let tasksHTML = '';
        tasks.slice(0, 5).forEach(task => {
            const priorityColor = {
                'high': 'text-red-600 bg-red-100 dark:bg-red-900/20',
                'medium': 'text-yellow-600 bg-yellow-100 dark:bg-yellow-900/20',
                'low': 'text-green-600 bg-green-100 dark:bg-green-900/20'
            }[task.priority] || 'text-slate-600 bg-slate-100';

            const statusIcon = {
                'todo': 'radio_button_unchecked',
                'in-progress': 'pending',
                'done': 'check_circle'
            }[task.status] || 'radio_button_unchecked';

            tasksHTML += `
                <div class="task-item px-6 py-4 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined ${task.status === 'done' ? 'text-green-500' : 'text-slate-400'}">${statusIcon}</span>
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <h3 class="font-medium text-slate-900 dark:text-white">${this.escapeHTML(task.title)}</h3>
                                <span class="text-xs px-2 py-1 rounded-full ${priorityColor}">${task.priority}</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-1">Due: ${task.dueDate}</p>
                        </div>
                    </div>
                </div>
            `;
        });
        
        tasksList.innerHTML = tasksHTML;
    }

    updatePRsList() {
        const prsList = document.getElementById('myPRsList');
        const prs = this.dashboardData.pullRequests || [];
        
        if (prs.length === 0) {
            prsList.innerHTML = `
                <div class="p-8 text-center text-slate-500">
                    <span class="material-symbols-outlined text-4xl mb-2 text-slate-300">code</span>
                    <p>No pull requests created by you</p>
                </div>
            `;
            return;
        }

        let prsHTML = '';
        prs.slice(0, 5).forEach(pr => {
            const statusColor = {
                'open': 'text-green-600 bg-green-100 dark:bg-green-900/20',
                'review': 'text-yellow-600 bg-yellow-100 dark:bg-yellow-900/20',
                'merged': 'text-purple-600 bg-purple-100 dark:bg-purple-900/20'
            }[pr.status] || 'text-slate-600 bg-slate-100';

            prsHTML += `
                <div class="task-item px-6 py-4 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors">
                    <div class="flex items-start gap-3">
                        <span class="material-symbols-outlined text-green-500">code</span>
                        <div class="flex-1">
                            <div class="flex items-center justify-between">
                                <h3 class="font-medium text-slate-900 dark:text-white">${this.escapeHTML(pr.title)}</h3>
                                <span class="text-xs px-2 py-1 rounded-full ${statusColor}">${pr.status}</span>
                            </div>
                            <div class="flex items-center gap-3 mt-1">
                                <span class="text-xs text-slate-500">${pr.repo}</span>
                                <span class="text-xs text-slate-500">â€¢</span>
                                <span class="text-xs text-slate-500">${pr.comments} comments</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        
        prsList.innerHTML = prsHTML;
    }

    updateProfile() {
        document.getElementById('profileName').textContent = this.userData.fullName || 'User';
        document.getElementById('profileEmail').textContent = this.userData.email || 'email@example.com';
        document.getElementById('profilePosition').textContent = this.userData.position || 'Developer';
        document.getElementById('profileCompany').textContent = this.dashboardData.company.name;
        document.getElementById('profileRole').textContent = this.userData.role || 'Employee';
        
        const joinedDate = this.userData.createdAt ? new Date(this.userData.createdAt).toLocaleDateString() : '2024-01-01';
        document.getElementById('profileJoined').textContent = joinedDate;
    }

    updateActivityGraph() {
        const graph = document.getElementById('activityGraph');
        // Generate random activity data for the week
        const days = [4, 6, 3, 7, 5, 2, 1];
        const max = Math.max(...days);
        
        let barsHTML = '';
        days.forEach(day => {
            const height = (day / max) * 100;
            barsHTML += `
                <div class="flex-1 flex flex-col items-center gap-1">
                    <div class="w-full bg-primary/10 rounded-sm" style="height: ${height}%"></div>
                    <span class="text-[10px] text-slate-500">${day}</span>
                </div>
            `;
        });
        
        graph.innerHTML = barsHTML;
    }

    updateRecentActivity() {
        const activityList = document.getElementById('recentActivity');
        const activities = this.dashboardData.activity || [];
        
        if (activities.length === 0) {
            activityList.innerHTML = `
                <div class="text-center py-4 text-slate-500">
                    <span class="material-symbols-outlined text-3xl mb-2 text-slate-300">history</span>
                    <p class="text-sm">No recent activity</p>
                </div>
            `;
            return;
        }

        let activityHTML = '';
        activities.forEach(act => {
            const icon = act.type === 'task' ? 'task' : 'code';
            activityHTML += `
                <div class="flex items-start gap-3 text-sm">
                    <span class="material-symbols-outlined text-sm text-primary">${icon}</span>
                    <div class="flex-1">
                        <p class="text-slate-700 dark:text-slate-300">
                            <span class="font-medium">You</span> ${act.action} 
                            <span class="font-medium">${act.item}</span>
                        </p>
                        <p class="text-xs text-slate-500 mt-0.5">${act.time}</p>
                    </div>
                </div>
            `;
        });
        
        activityList.innerHTML = activityHTML;
    }

    bindEvents() {
        document.getElementById('logoutBtn').addEventListener('click', () => this.logout());
        document.getElementById('copyCompanyCodeBtn').addEventListener('click', () => {
            const code = document.getElementById('companyCodeDisplay').textContent;
            this.copyToClipboard(code, 'Company code copied to clipboard!');
        });

        // AI Chat
        const aiChatForm = document.getElementById('aiChatForm');
        aiChatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            this.handleAIChat();
        });

        document.getElementById('aiModel').addEventListener('change', (e) => {
            document.getElementById('aiModelInfo').textContent = e.target.selectedOptions[0].text;
        });
    }

    // ========== MODAL FUNCTIONS ==========
    showCreateTaskModal() {
        const modalHTML = `
            <div id="createTaskModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                <div class="bg-white dark:bg-slate-900 rounded-2xl p-6 max-w-md w-full mx-4 border border-slate-200 dark:border-slate-800">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Create New Task</h3>
                        <button onclick="document.getElementById('createTaskModal').remove()" class="text-slate-400 hover:text-slate-600">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>
                    <form id="createTaskForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Task Title</label>
                            <input type="text" id="taskTitle" class="w-full px-4 py-2.5 rounded-lg border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Description</label>
                            <textarea id="taskDescription" rows="3" class="w-full px-4 py-2.5 rounded-lg border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Priority</label>
                                <select id="taskPriority" class="w-full px-4 py-2.5 rounded-lg border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Due Date</label>
                                <input type="date" id="taskDueDate" class="w-full px-4 py-2.5 rounded-lg border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none">
                            </div>
                        </div>
                        <div class="pt-4 flex justify-end gap-3">
                            <button type="button" onclick="document.getElementById('createTaskModal').remove()" class="px-4 py-2.5 text-slate-600 dark:text-slate-400 hover:text-slate-900">Cancel</button>
                            <button type="submit" class="px-6 py-2.5 bg-primary text-white font-medium rounded-lg hover:bg-primary/90">Create Task</button>
                        </div>
                    </form>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        document.getElementById('createTaskForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.createTask();
        });
    }

    showCreatePRModal() {
        const modalHTML = `
            <div id="createPRModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                <div class="bg-white dark:bg-slate-900 rounded-2xl p-6 max-w-md w-full mx-4 border border-slate-200 dark:border-slate-800">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Create Pull Request</h3>
                        <button onclick="document.getElementById('createPRModal').remove()" class="text-slate-400 hover:text-slate-600">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>
                    <form id="createPRForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">PR Title</label>
                            <input type="text" id="prTitle" class="w-full px-4 py-2.5 rounded-lg border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Repository</label>
                            <input type="text" id="prRepo" class="w-full px-4 py-2.5 rounded-lg border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none" placeholder="owner/repo" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Description</label>
                            <textarea id="prDescription" rows="3" class="w-full px-4 py-2.5 rounded-lg border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none"></textarea>
                        </div>
                        <div class="pt-4 flex justify-end gap-3">
                            <button type="button" onclick="document.getElementById('createPRModal').remove()" class="px-4 py-2.5 text-slate-600 dark:text-slate-400 hover:text-slate-900">Cancel</button>
                            <button type="submit" class="px-6 py-2.5 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700">Create PR</button>
                        </div>
                    </form>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        document.getElementById('createPRForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.createPR();
        });
    }

    showEditProfileModal() {
        const modalHTML = `
            <div id="editProfileModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
                <div class="bg-white dark:bg-slate-900 rounded-2xl p-6 max-w-md w-full mx-4 border border-slate-200 dark:border-slate-800">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Edit Profile</h3>
                        <button onclick="document.getElementById('editProfileModal').remove()" class="text-slate-400 hover:text-slate-600">
                            <span class="material-symbols-outlined">close</span>
                        </button>
                    </div>
                    <form id="editProfileForm" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Full Name</label>
                            <input type="text" id="editName" value="${this.escapeHTML(this.userData.fullName || '')}" class="w-full px-4 py-2.5 rounded-lg border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Position</label>
                            <input type="text" id="editPosition" value="${this.escapeHTML(this.userData.position || '')}" class="w-full px-4 py-2.5 rounded-lg border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-slate-900 dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20 outline-none">
                        </div>
                        <div class="pt-4 flex justify-end gap-3">
                            <button type="button" onclick="document.getElementById('editProfileModal').remove()" class="px-4 py-2.5 text-slate-600 dark:text-slate-400 hover:text-slate-900">Cancel</button>
                            <button type="submit" class="px-6 py-2.5 bg-primary text-white font-medium rounded-lg hover:bg-primary/90">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        document.getElementById('editProfileForm').addEventListener('submit', (e) => {
            e.preventDefault();
            this.updateProfileInfo();
        });
    }

    // ========== ACTION FUNCTIONS ==========
    createTask() {
        const title = document.getElementById('taskTitle').value;
        this.showNotification('Task Created', `Task "${title}" has been created`, 'success');
        document.getElementById('createTaskModal').remove();
    }

    createPR() {
        const title = document.getElementById('prTitle').value;
        this.showNotification('PR Created', `Pull request "${title}" has been created`, 'success');
        document.getElementById('createPRModal').remove();
    }

    updateProfileInfo() {
        const name = document.getElementById('editName').value;
        const position = document.getElementById('editPosition').value;
        
        this.userData.fullName = name;
        this.userData.position = position;
        localStorage.setItem('user', JSON.stringify(this.userData));
        
        this.showNotification('Profile Updated', 'Your profile has been updated', 'success');
        document.getElementById('editProfileModal').remove();
        
        // Update UI
        document.getElementById('profileName').textContent = name;
        document.getElementById('profilePosition').textContent = position;
        document.getElementById('currentUser').textContent = `Welcome, ${name}`;
        document.getElementById('welcomeMessage').textContent = `Welcome back, ${name}!`;
        
        // Update initials
        const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        document.getElementById('profileInitials').textContent = initials;
    }

    // ========== AI CHAT FUNCTIONS ==========
    async handleAIChat() {
        const input = document.getElementById('aiInput');
        const question = input.value.trim();
        
        if (!question) return;
        
        this.addUserMessage(question);
        input.value = '';
        this.setAILoading(true);
        
        try {
            // Mock AI response for now
            setTimeout(() => {
                const responses = [
                    "I can help you with that! Here's what you need to know...",
                    "That's a great question. Let me break it down for you.",
                    "Based on your tasks, I recommend focusing on high-priority items first.",
                    "I'd suggest creating a subtask for this to track progress better.",
                    "Have you considered discussing this with your team lead?"
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                this.addAIResponse(randomResponse, 'gpt-3.5-turbo', 150);
                this.setAILoading(false);
            }, 1000);
            
        } catch (error) {
            this.addAIError(error.message);
            this.setAILoading(false);
        }
    }

    addUserMessage(message) {
        const chatContainer = document.getElementById('aiChat');
        const messageHTML = `
            <div class="flex justify-end">
                <div class="max-w-[80%]">
                    <div class="bg-gradient-to-r from-primary to-blue-500 text-white p-4 rounded-lg rounded-tr-none">
                        <p class="text-sm">${this.escapeHTML(message)}</p>
                    </div>
                    <div class="text-right">
                        <span class="text-xs text-slate-500 mt-1">You â€¢ ${new Date().toLocaleTimeString()}</span>
                    </div>
                </div>
            </div>
        `;
        
        chatContainer.insertAdjacentHTML('beforeend', messageHTML);
        chatContainer.scrollTop = chatContainer.scrollHeight;
        this.aiChatHistory.push({ role: 'user', content: message });
    }

    addAIResponse(response, model, tokensUsed) {
        const chatContainer = document.getElementById('aiChat');
        const formattedResponse = this.formatMarkdown(response);
        
        const messageHTML = `
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-full bg-gradient-to-r from-green-500 to-blue-500 flex items-center justify-center flex-shrink-0">
                    <span class="text-white text-sm">AI</span>
                </div>
                <div class="flex-1">
                    <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-sm markdown-content">
                        ${formattedResponse}
                    </div>
                    <div class="flex items-center justify-between mt-2">
                        <span class="text-xs text-slate-500">AI Assistant â€¢ ${model}</span>
                        <span class="text-xs text-slate-500">${tokensUsed} tokens</span>
                    </div>
                </div>
            </div>
        `;
        
        chatContainer.insertAdjacentHTML('beforeend', messageHTML);
        chatContainer.scrollTop = chatContainer.scrollHeight;
        this.aiChatHistory.push({ role: 'assistant', content: response });
    }

    addAIError(errorMessage) {
        const chatContainer = document.getElementById('aiChat');
        const messageHTML = `
            <div class="flex items-start gap-3">
                <div class="w-8 h-8 rounded-full bg-red-500 flex items-center justify-center flex-shrink-0">
                    <span class="material-symbols-outlined text-white text-sm">error</span>
                </div>
                <div class="flex-1">
                    <div class="bg-red-50 dark:bg-red-900/20 p-4 rounded-lg shadow-sm">
                        <p class="text-sm text-red-700 dark:text-red-400">
                            <strong>Error:</strong> ${this.escapeHTML(errorMessage)}
                        </p>
                    </div>
                </div>
            </div>
        `;
        
        chatContainer.insertAdjacentHTML('beforeend', messageHTML);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    setAILoading(loading) {
        const input = document.getElementById('aiInput');
        const submitBtn = document.getElementById('aiSubmitBtn');
        const buttonText = document.getElementById('aiButtonText');
        const loadingSpinner = document.getElementById('aiLoading');
        
        input.disabled = loading;
        submitBtn.disabled = loading;
        
        if (loading) {
            buttonText.textContent = 'Thinking...';
            loadingSpinner.classList.remove('hidden');
        } else {
            buttonText.textContent = 'Ask AI';
            loadingSpinner.classList.add('hidden');
            input.focus();
        }
    }

    clearAIChat() {
        const chatContainer = document.getElementById('aiChat');
        // Keep only the initial welcome message
        const initialMessage = chatContainer.querySelector('.flex.items-start:first-child');
        chatContainer.innerHTML = '';
        if (initialMessage) {
            chatContainer.appendChild(initialMessage);
        }
        this.aiChatHistory = [];
    }

    // ========== UTILITY FUNCTIONS ==========
    showNotification(title, message, type = 'success') {
        const toast = document.getElementById('notificationToast');
        const toastIcon = document.getElementById('toastIcon');
        const toastTitle = document.getElementById('toastTitle');
        const toastMessage = document.getElementById('toastMessage');
        
        toastIcon.textContent = type === 'success' ? 'check_circle' : 'error';
        toastIcon.className = `material-symbols-outlined text-${type === 'success' ? 'green' : 'red'}-500`;
        toastTitle.textContent = title;
        toastMessage.textContent = message;
        
        toast.classList.remove('hidden');
        
        setTimeout(() => {
            toast.classList.add('hidden');
        }, 5000);
    }

    copyToClipboard(text, successMessage) {
        navigator.clipboard.writeText(text).then(() => {
            this.showNotification('Copied!', successMessage, 'success');
        });
    }

    escapeHTML(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    formatMarkdown(text) {
        let html = this.escapeHTML(text);
        html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');
        html = html.replace(/`([^`]+)`/g, '<code class="bg-slate-200 dark:bg-slate-700 px-1 py-0.5 rounded">$1</code>');
        html = html.replace(/\n/g, '<br>');
        return html;
    }

    logout() {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        window.location.href = 'login.html';
    }
}

// Global helper
function hideToast() {
    document.getElementById('notificationToast').classList.add('hidden');
}

// Initialize dashboard
document.addEventListener('DOMContentLoaded', () => {
    window.employeeDashboard = new EmployeeDashboard();
});
</script>
</body>
</html>